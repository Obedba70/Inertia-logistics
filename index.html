<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inertia Logistics • Forum</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root { --navy:#0a1d37; --orange:#ff6b00; --deep:#051028; }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:#051028; color:white; font-family:'Rajdhani',sans-serif; min-height:100vh; }
  .hidden { display:none!important; }

  /* LOGIN */
  #loginScreen { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px; }
  .login-box { background:rgba(10,29,55,0.97); padding:50px 30px; border-radius:24px; text-align:center;
    max-width:380px; width:100%; border:3px solid var(--orange); box-shadow:0 0 60px rgba(255,107,0,0.6); }
  .login-box h1 { font-family:'Orbitron',sans-serif; font-size:2.6rem; color:var(--orange);
    text-shadow:0 0 20px var(--orange); margin-bottom:12px; letter-spacing:-1px; }
  @media (max-width:360px) { .login-box h1 { font-size:2.3rem; } }

  input, textarea { width:100%; padding:16px; margin:12px 0; border-radius:12px; border:none;
    background:rgba(255,255,255,0.12); color:white; font-size:1.1rem; }
  .btn { display:block; width:100%; padding:16px; margin:12px 0; border-radius:50px;
    background:var(--orange); color:white; border:none; cursor:pointer; font-weight:bold; font-size:1.2rem; }
  .btn:hover { opacity:0.9; }
  .btn-discord { background:#5865F2; }

  header { background:var(--deep); padding:15px 20px; display:flex; justify-content:space-between;
    align-items:center; border-bottom:4px solid var(--orange); position:sticky; top:0; z-index:100; }
  .logo { font-family:'Orbitron',sans-serif; font-size:1.9rem; color:var(--orange); }

  .container { max-width:1400px; margin:20px auto; padding:0 15px; display:grid; grid-template-columns:1fr 360px; gap:25px; }
  .card { background:rgba(255,255,255,0.07); border-radius:16px; padding:25px; border:1px solid rgba(255,107,0,0.2); }
  .topic { background:rgba(255,255,255,0.1); padding:18px; border-radius:12px; margin:15px 0;
    border-left:5px solid var(--orange); display:flex; justify-content:space-between; align-items:center; }
  .topic-title { font-size:1.4rem; font-weight:bold; color:var(--orange); }
  .topic-meta { color:#aaa; font-size:0.9rem; }

  #shouts { height:65vh; overflow-y:auto; }
  .shout { padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.1); }
  .shout strong { color:var(--orange); }

  .ingame-name { color:#ff6b00; font-weight:bold; }
  @media (max-width:900px) { .container { grid-template-columns:1fr; } }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <h1>INERTIA LOGISTICS</h1>
    <p>Drive with the Force. Choose Inertia.</p>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="pass" placeholder="Password">
    <button class="btn" onclick="login()">Login</button>
    <button class="btn" onclick="signup()" style="background:#e67e22;">Create Account</button>
    <a href="https://convoytrucking.net/club/Inertia%20Logistics" target="_blank" class="btn">Apply to Club</a>
    <a href="https://convoytrucking.net/club/Inertia%20Logistics/members" target="_blank" class="btn" style="background:#27ae60;">View Members</a>
    <a href="https://discord.gg/H5EAuVvRpD" target="_blank" class="btn btn-discord">Join Discord</a>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <header>
    <div class="logo">Inertia Logistics</div>
    <div>
      <span id="userName" class="ingame-name"></span>
      <button onclick="logout()" style="background:none;border:none;color:#ff6b00;cursor:pointer;margin-left:15px;">Logout</button>
    </div>
  </header>

  <div class="container">
    <!-- FORUM -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <h2 style="color:#ff6b00;">Forum Topics</h2>
        <button class="btn" onclick="showNewTopic()" style="padding:12px 24px;font-size:1rem;">+ New Topic</button>
      </div>
      <div id="topics"></div>
    </div>

    <!-- SIDEBAR -->
    <div class="card">
      <h3 style="color:#ff6b00;">Live Shoutbox</h3>
      <div id="shouts"></div>
      <div style="margin-top:15px;display:flex;gap:10px;">
        <input type="text" id="shoutInput" placeholder="Say something..." maxlength="160">
        <button onclick="sendShout()" class="btn" style="padding:12px 20px;">Send</button>
      </div>
      <div style="margin-top:25px;">
        <button onclick="showInGameNameModal()" class="btn" style="background:#9b59b6;width:100%;">Set In-Game Name (IceBlaze)</button>
        <a href="https://convoytrucking.net/club/Inertia%20Logistics/members" target="_blank"
           style="display:block;background:#27ae60;padding:14px;border-radius:50px;text-align:center;margin-top:10px;font-weight:bold;">
           View Member List
        </a>
      </div>
    </div>
  </div>
</div>

<!-- SET IN-GAME NAME MODAL -->
<div id="ingameModal" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:flex;align-items:center;justify-content:center;z-index:999;">
  <div style="background:#0f3460;padding:30px;border-radius:20px;width:90%;max-width:400px;border:2px solid #ff6b00;text-align:center;">
    <h2 style="color:#ff6b00;margin-bottom:20px;">Set Your In-Game Name</h2>
    <input type="text" id="ingameInput" placeholder="e.g. IceBlaze" style="width:100%;padding:16px;margin:15px 0;border-radius:12px;background:#1a1a2e;color:white;border:none;text-align:center;font-size:1.2rem;">
    <div>
      <button onclick="hideInGameNameModal()" style="background:#666;padding:12px 20px;border-radius:50px;">Cancel</button>
      <button onclick="saveInGameName()" class="btn" style="margin-left:15px;padding:12px 30px;">Save</button>
    </div>
  </div>
</div>

<!-- NEW TOPIC MODAL (same as before) -->
<div id="newTopicModal" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:999;">
  <div style="background:#0f3460;padding:30px;border-radius:20px;width:90%;max-width:500px;border:2px solid #ff6b00;">
    <h2 style="color:#ff6b00;margin-bottom:20px;">Create New Topic</h2>
    <input type="text" id="topicTitle" placeholder="Topic Title">
    <textarea id="topicBody" placeholder="Write your post..."></textarea>
    <div style="text-align:right;">
      <button onclick="hideNewTopic()" style="background:#666;padding:12px 20px;border-radius:50px;margin-left:10px;">Cancel</button>
      <button onclick="createTopic()" class="btn">Post Topic</button>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = { apiKey: "AIzaSyDw5vT5v5T5v5T5v5T5v5T5v5T5v5T5v5T", authDomain: "inertia-logistics-real.firebaseapp.com", projectId: "inertia-logistics-real", storageBucket: "inertia-logistics-real.appspot.com", messagingSenderId: "123456789", appId: "1:123456789:web:abcdef123456789" };
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
let ingameName = "";

auth.onAuthStateChanged(async user => {
  if (user) {
    const doc = await db.collection("users").doc(user.uid).get();
    ingameName = doc.exists && doc.data().ingame ? doc.data().ingame : user.email.split("@")[0];
    document.getElementById("userName").textContent = ingameName;
    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    loadTopics();
    loadShouts();
  } else {
    document.getElementById("loginScreen").classList.remove("hidden");
    document.getElementById("app").classList.add("hidden");
  }
});

window.login = () => { const e = document.getElementById("email").value.trim(); const p = document.getElementById("pass").value; if(!e||!p) return alert("Fill both"); auth.signInWithEmailAndPassword(e,p).catch(err=>alert(err.message)); };
window.signup = () => { const e = document.getElementById("email").value.trim(); const p = document.getElementById("pass").value; if(!e||!p) return alert("Fill both"); if(p.length<6) return alert("6+ chars"); auth.createUserWithEmailAndPassword(e,p).then(()=>alert("Account created!")).catch(err=>alert(err.message)); };
window.logout = () => auth.signOut();

// In-Game Name
window.showInGameNameModal = () => document.getElementById("ingameModal").classList.remove("hidden");
window.hideInGameNameModal = () => document.getElementById("ingameModal").classList.add("hidden");
window.saveInGameName = () => {
  const name = document.getElementById("ingameInput").value.trim();
  if (!name) return alert("Enter your in-game name");
  db.collection("users").doc(auth.currentUser.uid).set({ ingame: name }, { merge: true }).then(() => {
    ingameName = name;
    document.getElementById("userName").textContent = name;
    hideInGameNameModal();
  });
};

// Topics & Shoutbox (uses ingameName)
window.createTopic = () => {
  const title = document.getElementById("topicTitle").value.trim();
  const body = document.getElementById("topicBody").value.trim();
  if (!title || !body) return alert("Fill title and body");
  db.collection("topics").add({ title, body, author: ingameName, time: firebase.firestore.FieldValue.serverTimestamp() });
  hideNewTopic();
};
window.showNewTopic = () => document.getElementById("newTopicModal").classList.remove("hidden");
window.hideNewTopic = () => { document.getElementById("newTopicModal").classList.add("hidden"); document.getElementById("topicTitle").value = ""; document.getElementById("topicBody").value = ""; };

function loadTopics() {
  db.collection("topics").orderBy("time","desc").onSnapshot(snap => {
    document.getElementById("topics").innerHTML = "";
    snap.forEach(doc => {
      const t = doc.data();
      const div = document.createElement("div"); div.className = "topic";
      div.innerHTML = `<div><div class="topic-title">${t.title}</div><div class="topic-meta">by ${t.author} • just now</div></div><div>→</div>`;
      document.getElementById("topics").appendChild(div);
    });
  });
}

window.sendShout = () => {
  const msg = document.getElementById("shoutInput").value.trim();
  if (msg) {
    db.collection("shouts").add({ user: ingameName, msg, time: firebase.firestore.FieldValue.serverTimestamp() });
    document.getElementById("shoutInput").value = "";
  }
};

db.collection("shouts").orderBy("time","desc").limit(50).onSnapshot(snap => {
  document.getElementById("shouts").innerHTML = "";
  snap.docs.reverse().forEach(doc => {
    const s = doc.data();
    const d = document.createElement("div"); d.className = "shout";
    d.innerHTML = `<strong>${s.user}:</strong> ${s.msg}`;
    document.getElementById("shouts").appendChild(d);
  });
  document.getElementById("shouts").scrollTop = document.getElementById("shouts").scrollHeight;
});
</script>
</body>
</html>