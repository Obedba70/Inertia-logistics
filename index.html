<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inertia Logistics</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js linker></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<style>
  :root { --bg:#0a0e17; --card:#12151f; --orange:#ff6b00; --green:#00ff80; }
  * { margin:0; padding:0; box-sizing:border-box; font-family:system-ui,-apple-system,Arial; }
  body { background:var(--bg); color:white; min-height:100vh; }
  .header { position:fixed; top:0; left:0; right:0; background:#0a0e17; border-bottom:4px solid var(--orange); padding:15px; text-align:center; z-index:1000; }
  .header h1 { color:var(--orange); font-size:32px; font-weight:900; text-shadow:0 0 20px #ff6b00; }
  .online { position:fixed; top:18px; right:15px; background:var(--orange); color:black; padding:8px 20px; border-radius:50px; font-weight:bold; font-size:15px; }
  .shoutbox { position:fixed; top:68px; left:0; right:0; background:#0f131c; border-bottom:3px solid var(--orange); padding:12px; z-index:999; }
  .shouts { height:130px; overflow-y:auto; margin-bottom:10px; font-size:15px; padding:0 5px; }
  .shout span { color:var(--green); font-weight:bold; }
  .shout-input { width:100%; padding:14px 18px; background:#1a1f2e; border:2px solid var(--orange); color:white; border-radius:50px; font-size:16px; }
  .feed { padding-top:230px; padding-bottom:80px; }
  .post { background:var(--card); max-width:520px; margin:20px auto; border-radius:20px; overflow:hidden; box-shadow:0 8px 32px rgba(255,107,0,0.15); }
  .post-header { padding:16px; display:flex; align-items:center; gap:12px; }
  .name { color:var(--green); font-weight:700; font-size:17px; }
  .post-img { width:100%; display:block; }
  .post-text { padding:0 16px 12px; font-size:16px; }
  .actions { padding:10px 16px; display:flex; gap:25px; font-size:22px; }
  .like { cursor:pointer; }
  .liked { filter:brightness(1.5); }
  .new-post-btn { position:fixed; bottom:25px; right:20px; background:var(--orange); color:black; width:64px; height:64px; border-radius:50%; font-size:36px; font-weight:bold; border:none; box-shadow:0 0 30px rgba(255,107,0,0.7); z-index:999; }
  .hidden { display:none; }
  .login-screen { position:fixed; top:0; left:0; right:0; bottom:0; background:var(--bg); display:flex; flex-direction:column; align-items:center; justify-content:center; gap:20px; z-index:10000; }
  .login-screen input { width:300px; padding:16px; background:#1a1f2e; border:none; border-radius:50px; color:white; font-size:17px; }
  .login-screen button { background:var(--orange); color:black; padding:16px 50px; border:none; border-radius:50px; font-weight:bold; font-size:18px; }
</style>
</head>
<body>

<div class="header">
  <h1>INERTIA LOGISTICS</h1>
  <div class="online" onclick="showOnline()">0 Online</div>
</div>

<div class="shoutbox">
  <div class="shouts" id="shouts"></div>
  <input type="text" class="shout-input" id="shoutInput" placeholder="Shout to the crew..." onkeypress="if(event.key==='Enter') shout()">
</div>

<div class="feed" id="feed"></div>
<button class="new-post-btn" onclick="document.getElementById('fileInput').click()">+</button>
<input type="file" id="fileInput" accept="image/*" style="display:none" onchange="uploadPost(this.files[0])">

<div id="loginScreen" class="login-screen">
  <h1 style="color:var(--orange);font-size:42px;">Inertia Logistics</h1>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">LOGIN</button>
  <button onclick="signup()" style="background:#333;">CREATE ACCOUNT</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAnfQTsgdSf6c4Wty6XbN4xdkSVp7d3KvM",
  authDomain: "inertia-logistics.firebaseapp.com",
  projectId: "inertia-logistics",
  storageBucket: "inertia-logistics.firebasestorage.app",
  messagingSenderId: "478964604946",
  appId: "1:478964604946:web:8e9373cad36ceb88afb8cb"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let currentUser = null;
let inGameName = "Driver";

auth.onAuthStateChanged(async user => {
  if (user) {
    currentUser = user;
    document.getElementById("loginScreen").classList.add("hidden");
    const doc = await db.collection("users").doc(user.uid).get();
    if (doc.exists && doc.data().inGameName) inGameName = doc.data().inGameName;
    loadFeed();
    loadShouts();
    keepOnline();
    setInterval(keepOnline, 10000);
  }
});

function login() { auth.signInWithEmailAndPassword(email.value, password.value).catch(e=>alert(e.message)); }
function signup() { 
  auth.createUserWithEmailAndPassword(email.value, password.value)
    .then(() => db.collection("users").doc(auth.currentUser.uid).set({inGameName:"Driver", joined:new Date()}))
    .catch(e=>alert(e.message));
}

async function uploadPost(file) {
  if (!file) return;
  const caption = prompt("Caption (optional):", "") || "";
  const ref = storage.ref("posts/" + Date.now());
  await ref.put(file);
  const url = await ref.getDownloadURL();
  await db.collection("posts").add({
    uid: currentUser.uid,
    name: inGameName,
    caption,
    url,
    likes: [],
    time: firebase.firestore.FieldValue.serverTimestamp()
  });
}

async function shout() {
  const text = document.getElementById("shoutInput").value.trim();
  if (!text) return;
  await db.collection("shouts").add({
    name: inGameName,
    text,
    time: firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById("shoutInput").value = "";
}

function loadShouts() {
  db.collection("shouts").orderBy("time","desc").limit(40).onSnapshot(snap => {
    const div = document.getElementById("shouts");
    div.innerHTML = "";
    snap.docs.reverse().forEach(doc => {
      const d = doc.data();
      div.innerHTML += `<div class="shout"><span>${d.name} Truck:</span> ${d.text}</div>`;
    });
  });
}

function loadFeed() {
  db.collection("posts").orderBy("time","desc").onSnapshot(snap => {
    const feed = document.getElementById("feed");
    feed.innerHTML = "";
    snap.forEach(doc => {
      const p = doc.data();
      const liked = p.likes.includes(currentUser.uid);
      feed.innerHTML += `
        <div class="post">
          <div class="post-header">
            <div class="name">${p.name} Truck</div>
          </div>
          ${p.caption ? `<div class="post-text">${p.caption}</div>` : ""}
          ${p.url ? `<img src="${p.url}" class="post-img">` : ""}
          <div class="actions">
            <span class="like ${liked?'liked':''}" onclick="toggleLike('${doc.id}')"> ${liked?'Full Heart':'Empty Heart'} ${p.likes.length}</span>
          </div>
        </div>`;
    });
  });
}

async function toggleLike(postId) {
  const ref = db.collection("posts").doc(postId);
  const doc = await ref.get();
  const likes = doc.data().likes || [];
  if (likes.includes(currentUser.uid)) {
    likes.splice(likes.indexOf(currentUser.uid), 1);
  } else {
    likes.push(currentUser.uid);
  }
  await ref.update({likes});
}

function keepOnline() {
  if (currentUser) {
    db.collection("online").doc(currentUser.uid).set({
      name: inGameName,
      time: Date.now()
    }, {merge:true});
  }
}
db.collection("online").onSnapshot(snap => {
  document.querySelector(".online").textContent = snap.size + " Online";
});

function showOnline() {
  db.collection("online").get().then(snap => {
    let list = "ONLINE DRIVERS\n\n";
    snap.forEach(d => list += "Truck " + d.data().name + "\n");
    alert(list || "Nobody online");
  });
}
</script>

<center style="margin:100px 20px; color:var(--orange); font-size:26px;">
  <b>PASTE THIS NOW = 100% FIXED, NO MORE UNDEFINED, PURE FIRE</b><br><br>
  <a href="https://github.com/obeddb70/inertia-logistics/edit/main/index.html" target="_blank"
     style="background:var(--orange);color:black;padding:20px 60px;border-radius:50px;font-size:30px;text-decoration:none;font-weight:bold;">
    REPLACE FILE NOW
  </a>
</center>
